language: node_js

node_js:
  - 4.8.7

build:
  ci:
    - printenv
    - apt-get install tree
    - TRANSFER=$(shipctl get_resource_state in_job)
    - tree $TRANSFER
    - sha1sum $TRANSFER/sample_node_repo.tar
    - stat $TRANSFER/sample_node_repo.tar
    - du -h $TRANSFER
    - cat $TRANSFER/in_job.env
    - echo STATE IN-OUT TESTS
    - RES_STATE_FILES=$(shipctl get_resource_state res_state)
    - echo "Reading from $RES_STATE_FILES"
    - tree $RES_STATE_FILES
    #- sha1sum $RES_STATE_FILES/sample_node_repo.tar 
    #- stat $RES_STATE_FILES/sample_node_repo.tar
    #- cat $RES_STATE_FILES/sample_node_runCI.env
    - echo "Writing to $RES_STATE_FILES"
    - tar cvf $RES_STATE_FILES/sample_node_repo.tar $SAMPLE_NODE_REPO_STATE
    - shipctl post_resource_state in_job "KEY1" "in_job_value1_"$SHIPPABLE_BUILD_NUMBER
    - shipctl put_resource_state in_job "KEY2" "in_job_value2_"$SHIPPABLE_BUILD_NUMBER   
    - sha1sum $RES_STATE_FILES/sample_node_repo.tar 
    - stat $RES_STATE_FILES/sample_node_repo.tar
    - cat $RES_STATE_FILES/in_job.env
